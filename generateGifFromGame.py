#!/usr/bin/env python3

import sys
import re
import json
import xml.etree.ElementTree as ET
import pyquery
import imageio
import urllib.request
from svglib.svglib import svg2rlg
from reportlab.graphics import renderPM
from os.path import exists
from selenium import webdriver
from enum import Enum


# Definitions stolen from the parsing of the game
territories = {'ADR': {'center': {'x': 308, 'y': 460},
         'l_neighbors': {'Alb': 1, 'Apu': 1, 'Tri': 1, 'Ven': 1},
         'name': 'Adriatic Sea',
         'path': 'M322,480 L297,456 L300,453 L290,453 L278,443 L272,424 '
                 'L260,417 L261,401 L270,398 L276,399 L275,403 L278,410 '
                 'L282,401 L286,402 L289,418 L306,436 L331,454 L331,477 '
                 'L335,480Z',
         'type': 'w',
         'unit_center': {'x': 296, 'y': 441},
         'w_neighbors': {'ION': 1}},
 'AEG': {'center': {'x': 392, 'y': 510},
         'l_neighbors': {'Bulsc': 1, 'Con': 1, 'Gre': 1, 'Smy': 1},
         'name': 'Aegean Sea',
         'path': 'M376,537 L371,520 L378,521 L377,513 L386,516 L385,509 '
                 'L370,494 L371,491 L378,494 L368,483 L371,477 L379,484 '
                 'L382,483 L381,477 L386,478 L380,472 L392,472 L400,468 '
                 'L408,470 L410,473 L414,475 L410,482 L409,487 L417,486 '
                 'L417,489 L420,495 L417,498 L417,507 L423,510 L427,524 '
                 'L435,523 L435,530 L416,549 L412,547 L387,546 L383,544Z',
         'type': 'w',
         'unit_center': {'x': 403, 'y': 524},
         'w_neighbors': {'BLA': 1, 'EAS': 1, 'ION': 1}},
 'Alb': {'center': {'x': 333, 'y': 460},
         'l_neighbors': {'Gre': 1, 'Ser': 1, 'Tri': 1},
         'name': 'Albania',
         'path': 'M331,454 L331,477 L335,480 L339,487 L350,477 L350,471 '
                 'L346,466 L346,452 L337,446 L330,445Z',
         'type': 'l',
         'unit_center': {'x': 339, 'y': 469},
         'w_neighbors': {'ADR': 1, 'Gre': 1, 'ION': 1, 'Tri': 1}},
 'Ank': {'center': {'x': 510, 'y': 455},
         'l_neighbors': {'Arm': 1, 'Con': 1, 'Smy': 1},
         'name': 'Ankara',
         'path': 'M555,438 L551,437 L520,441 L514,438 L511,440 L502,433 '
                 'L481,438 L470,447 L464,457 L468,461 L468,479 L466,491 '
                 'L473,491 L490,480 L501,482 L508,480 L531,460 L546,462 '
                 'L555,460 L557,449Z',
         'sc': {'x': 482, 'y': 469},
         'type': 'l',
         'unit_center': {'x': 500, 'y': 460},
         'w_neighbors': {'Arm': 1, 'BLA': 1, 'Con': 1}},
 'Apu': {'center': {'x': 291, 'y': 470},
         'l_neighbors': {'Nap': 1, 'Rom': 1, 'Ven': 1},
         'name': 'Apulia',
         'path': 'M304,484 L310,480 L318,485 L322,485 L322,480 L297,456 '
                 'L300,453 L290,453 L278,443 L274,447 L279,451 L280,455 '
                 'L279,458 L293,481Z',
         'type': 'l',
         'unit_center': {'x': 302, 'y': 472},
         'w_neighbors': {'ADR': 1, 'ION': 1, 'Nap': 1, 'Ven': 1}},
 'Arm': {'center': {'x': 585, 'y': 467},
         'l_neighbors': {'Ank': 1, 'Sev': 1, 'Smy': 1, 'Syr': 1},
         'name': 'Armenia',
         'path': 'M609,493 L584,478 L563,479 L562,471 L556,467 L555,460 '
                 'L557,449 L555,438 L570,427 L589,442 L594,439 L603,441 '
                 'L609,440Z',
         'type': 'l',
         'unit_center': {'x': 576, 'y': 456},
         'w_neighbors': {'Ank': 1, 'BLA': 1, 'Sev': 1}},
 'BAL': {'center': {'x': 308, 'y': 260},
         'l_neighbors': {'Ber': 1,
                         'Den': 1,
                         'Kie': 1,
                         'Lvn': 1,
                         'Pru': 1,
                         'Swe': 1},
         'name': 'Baltic Sea',
         'path': 'M266,255 L271,260 L278,254 L277,250 L280,248 L279,243 '
                 'L282,253 L289,254 L294,245 L305,244 L312,229 L311,220 '
                 'L359,220 L349,229 L347,243 L347,248 L348,254 L344,262 '
                 'L337,264 L334,273 L328,274 L326,265 L314,266 L307,273 '
                 'L294,275 L286,274 L287,267 L280,266 L266,275 L261,274 '
                 'L260,269 L256,266 L256,263 L254,255Z',
         'type': 'w',
         'unit_center': {'x': 323, 'y': 250},
         'w_neighbors': {'BOT': 1, 'SKA': 1}},
 'BAR': {'center': {'x': 440, 'y': 15},
         'l_neighbors': {'Nwy': 1, 'Stpnc': 1},
         'name': 'Barents Sea',
         'path': 'M540,0 L535,9 L530,6 L517,19 L516,33 L513,38 L513,23 L507,20 '
                 'L505,26 L499,33 L492,48 L495,58 L488,60 L479,57 L477,55 '
                 'L481,50 L473,43 L466,45 L472,62 L478,66 L478,74 L472,72 '
                 'L468,74 L457,91 L469,100 L467,106 L462,109 L444,101 L442,110 '
                 'L447,115 L454,119 L452,122 L434,118 L426,103 L426,94 L414,88 '
                 'L412,83 L445,84 L457,79 L459,66 L453,61 L417,47 L405,49 '
                 'L401,45 L397,48 L391,47 L395,41 L394,38 L384,33 L382,40 '
                 'L380,33 L377,31 L374,38 L371,33 L366,42 L366,33 L362,33 '
                 'L362,0Z',
         'type': 'w',
         'unit_center': {'x': 445, 'y': 41},
         'w_neighbors': {'NWG': 1}},
 'BLA': {'center': {'x': 500, 'y': 418},
         'l_neighbors': {'Ank': 1,
                         'Arm': 1,
                         'Bulec': 1,
                         'Con': 1,
                         'Rum': 1,
                         'Sev': 1},
         'name': 'Black Sea',
         'path': 'M440,458 L430,455 L426,450 L422,441 L425,427 L429,426 '
                 'L430,423 L432,409 L439,404 L438,397 L446,378 L459,375 '
                 'L461,377 L459,379 L465,383 L476,381 L478,383 L472,385 '
                 'L468,392 L477,396 L477,401 L486,404 L488,397 L494,396 '
                 'L497,392 L507,389 L506,384 L494,387 L485,378 L503,364 '
                 'L526,351 L527,354 L514,365 L517,371 L520,371 L515,384 '
                 'L511,383 L510,386 L517,393 L528,394 L554,406 L567,408 '
                 'L573,417 L570,427 L555,438 L551,437 L520,441 L514,438 '
                 'L511,440 L502,433 L481,438 L470,447 L464,457 L442,460Z',
         'type': 'w',
         'unit_center': {'x': 484, 'y': 420},
         'w_neighbors': {'AEG': 1}},
 'BOT': {'center': {'x': 328, 'y': 175},
         'l_neighbors': {'Fin': 1, 'Lvn': 1, 'Stpsc': 1, 'Swe': 1},
         'name': 'Gulf of Bothnia',
         'path': 'M311,220 L314,209 L322,206 L328,203 L331,193 L326,183 '
                 'L320,182 L321,161 L330,146 L343,138 L351,128 L347,121 '
                 'L349,112 L355,104 L362,107 L368,108 L372,120 L366,121 '
                 'L359,136 L345,151 L347,160 L350,165 L348,178 L349,184 '
                 'L357,186 L365,191 L384,185 L402,177 L403,183 L411,184 '
                 'L414,187 L408,187 L400,192 L399,197 L387,196 L371,198 '
                 'L369,202 L365,204 L368,210 L372,213 L373,221 L377,227 '
                 'L373,229 L366,228 L359,220Z',
         'type': 'w',
         'unit_center': {'x': 348, 'y': 199},
         'w_neighbors': {'BAL': 1}},
 'Bel': {'center': {'x': 192, 'y': 321},
         'l_neighbors': {'Bur': 1, 'Hol': 1, 'Pic': 1, 'Ruh': 1},
         'name': 'Belgium',
         'path': 'M191,299 L194,303 L206,306 L205,311 L208,315 L210,326 '
                 'L205,331 L192,323 L184,315 L169,311 L173,301Z',
         'sc': {'x': 186, 'y': 305},
         'type': 'l',
         'unit_center': {'x': 197, 'y': 317},
         'w_neighbors': {'ENG': 1, 'Hol': 1, 'NTH': 1, 'Pic': 1}},
 'Ber': {'center': {'x': 272, 'y': 292},
         'l_neighbors': {'Kie': 1, 'Mun': 1, 'Pru': 1, 'Sil': 1},
         'name': 'Berlin',
         'path': 'M294,275 L286,274 L287,267 L280,266 L266,275 L266,283 '
                 'L262,287 L264,293 L261,296 L263,310 L288,305 L296,300 '
                 'L297,296 L292,290Z',
         'sc': {'x': 281, 'y': 298},
         'type': 'l',
         'unit_center': {'x': 279, 'y': 283},
         'w_neighbors': {'BAL': 1, 'Kie': 1, 'Pru': 1}},
 'Boh': {'center': {'x': 283, 'y': 347},
         'l_neighbors': {'Gal': 1, 'Mun': 1, 'Sil': 1, 'Tyr': 1, 'Vie': 1},
         'name': 'Bohemia',
         'path': 'M281,356 L276,346 L268,343 L264,329 L266,325 L278,326 '
                 'L288,321 L297,322 L311,334 L314,332 L321,339 L322,347 '
                 'L316,348 L303,346 L295,349 L292,357Z',
         'type': 'l',
         'unit_center': {'x': 289, 'y': 336},
         'w_neighbors': {}},
 'Bre': {'center': {'x': 130, 'y': 345},
         'l_neighbors': {'Gas': 1, 'Par': 1, 'Pic': 1},
         'name': 'Brest',
         'path': 'M150,319 L144,318 L142,312 L136,310 L136,326 L124,323 '
                 'L122,318 L102,317 L100,322 L103,328 L109,329 L123,344 '
                 'L122,350 L123,357 L128,363 L146,365 L146,337 L148,329Z',
         'sc': {'x': 106, 'y': 322},
         'type': 'l',
         'unit_center': {'x': 125, 'y': 334},
         'w_neighbors': {'ENG': 1, 'Gas': 1, 'MAO': 1, 'Pic': 1}},
 'Bud': {'center': {'x': 350, 'y': 390},
         'l_neighbors': {'Gal': 1, 'Rum': 1, 'Ser': 1, 'Tri': 1, 'Vie': 1},
         'name': 'Budapest',
         'path': 'M394,376 L395,382 L401,385 L406,396 L401,402 L387,402 '
                 'L367,406 L365,412 L360,413 L342,410 L338,412 L335,410 '
                 'L332,410 L323,408 L321,398 L311,394 L308,383 L311,375 '
                 'L322,370 L335,354 L337,350 L350,347 L360,351 L368,353 '
                 'L377,360 L378,363 L384,365Z',
         'sc': {'x': 326, 'y': 376},
         'type': 'l',
         'unit_center': {'x': 353, 'y': 378},
         'w_neighbors': {}},
 'Bul': {'center': {'x': 395, 'y': 443},
         'coasts': {'ec': {'path': 'M412,454 L420,451 L426,450 L422,441 '
                                   'L425,427 L429,426 L430,423 L422,420 '
                                   'L410,420 L404,422 L398,427 L390,425 '
                                   'L382,427 L375,423 L370,425 L367,421 '
                                   'L365,425 L368,433 L371,438Z',
                           'x': 410,
                           'y': 440},
                    'sc': {'path': 'M413,464 L412,454 L371,438 L366,439 '
                                   'L371,456 L365,461 L369,464 L376,464 '
                                   'L388,460 L392,472 L400,468 L408,470 '
                                   'L413,464 L412,454Z',
                           'x': 399,
                           'y': 462}},
         'l_neighbors': {'Bul': 1, 'Con': 1, 'Gre': 1, 'Rum': 1, 'Ser': 1},
         'name': 'Bulgaria',
         'path': 'M413,464 L412,454 L420,451 L426,450 L422,441 L425,427 '
                 'L429,426 L430,423 L422,420 L410,420 L404,422 L398,427 '
                 'L390,425 L382,427 L375,423 L370,425 L367,421 L365,425 '
                 'L368,433 L371,438 L366,439 L371,456 L365,461 L369,464 '
                 'L376,464 L388,460 L392,472 L400,468 L408,470 L413,464 '
                 'L412,454Z',
         'sc': {'x': 377, 'y': 444},
         'type': 'l',
         'unit_center': {'x': 395, 'y': 443},
         'w_neighbors': {'ec': {'BLA': 1, 'Con': 1, 'Rum': 1},
                         'sc': {'AEG': 1, 'Con': 1, 'Gre': 1}}},
 'Bur': {'center': {'x': 185, 'y': 371},
         'l_neighbors': {'Bel': 1,
                         'Gas': 1,
                         'Mar': 1,
                         'Mun': 1,
                         'Par': 1,
                         'Pic': 1,
                         'Ruh': 1},
         'name': 'Burgundy',
         'path': 'M192,323 L205,331 L204,338 L211,346 L213,352 L209,363 '
                 'L208,367 L194,382 L178,381 L178,390 L173,396 L168,395 '
                 'L163,387 L165,383 L158,380 L156,374 L165,365 L185,344 '
                 'L188,332Z',
         'type': 'l',
         'unit_center': {'x': 191, 'y': 360},
         'w_neighbors': {}},
 'Cly': {'center': {'x': 133, 'y': 201},
         'l_neighbors': {'Edi': 1, 'Lvp': 1},
         'name': 'Clyde',
         'path': 'M138,214 L130,208 L129,197 L139,189 L140,182 L148,177 '
                 'L162,181 L161,185 L154,188 L152,194 L146,200 L144,213Z',
         'type': 'l',
         'unit_center': {'x': 139, 'y': 188},
         'w_neighbors': {'Edi': 1, 'Lvp': 1, 'NAO': 1, 'NWG': 1}},
 'Con': {'center': {'x': 437, 'y': 486},
         'l_neighbors': {'Ank': 1, 'Bul': 1, 'Smy': 1},
         'name': 'Constantinople',
         'path': 'M408,470 L410,473 L414,475 L410,482 L409,487 L417,486 '
                 'L417,489 L423,487 L432,493 L452,495 L466,491 L468,479 '
                 'L468,461 L464,457 L442,460 L440,458 L430,455 L426,450 '
                 'L420,451 L412,454 L413,464Z',
         'sc': {'x': 424, 'y': 475},
         'type': 'l',
         'unit_center': {'x': 444, 'y': 471},
         'w_neighbors': {'AEG': 1,
                         'Ank': 1,
                         'BLA': 1,
                         'Bulec': 1,
                         'Bulsc': 1,
                         'Smy': 1}},
 'Den': {'center': {'x': 250, 'y': 235},
         'l_neighbors': {'Kie': 1, 'Swe': 1},
         'name': 'Denmark',
         'path': 'M279,243 L275,242 L269,243 L266,240 L267,234 L266,221 '
                 'L263,223 L248,224 L245,237 L243,247 L244,254 L254,255 '
                 'L266,255 L271,260 L278,254 L277,250 L280,248Z',
         'sc': {'x': 272, 'y': 252},
         'type': 'l',
         'unit_center': {'x': 256, 'y': 245},
         'w_neighbors': {'BAL': 1,
                         'HEL': 1,
                         'Kie': 1,
                         'NTH': 1,
                         'SKA': 1,
                         'Swe': 1}},
 'EAS': {'center': {'x': 455, 'y': 550},
         'l_neighbors': {'Smy': 1, 'Syr': 1},
         'name': 'Eastern Mediterranean',
         'path': 'M435,530 L441,526 L447,528 L453,534 L464,531 L466,521 '
                 'L475,520 L485,528 L491,530 L505,526 L511,514 L520,517 '
                 'L527,508 L530,509 L525,518 L526,530 L532,535 L528,559 '
                 'L400,559 L400,554 L414,552 L416,549Z',
         'type': 'w',
         'unit_center': {'x': 474, 'y': 546},
         'w_neighbors': {'AEG': 1, 'ION': 1}},
 'ENG': {'center': {'x': 135, 'y': 306},
         'l_neighbors': {'Bel': 1, 'Bre': 1, 'Lon': 1, 'Pic': 1, 'Wal': 1},
         'name': 'English Channel',
         'path': 'M173,301 L169,311 L153,315 L155,320 L150,319 L144,318 '
                 'L142,312 L136,310 L136,326 L124,323 L122,318 L102,317 '
                 'L88,303 L100,291 L110,292 L120,295 L124,291 L134,294 '
                 'L147,295 L160,298 L168,296Z',
         'type': 'w',
         'unit_center': {'x': 119, 'y': 307},
         'w_neighbors': {'IRI': 1, 'MAO': 1, 'NTH': 1}},
 'Edi': {'center': {'x': 152, 'y': 202},
         'l_neighbors': {'Cly': 1, 'Lvp': 1, 'Yor': 1},
         'name': 'Edinburgh',
         'path': 'M152,194 L158,193 L171,197 L170,202 L165,210 L158,214 '
                 'L151,215 L157,216 L161,218 L163,226 L155,228 L145,217 '
                 'L144,213 L146,200Z',
         'sc': {'x': 154, 'y': 219},
         'type': 'l',
         'unit_center': {'x': 157, 'y': 210},
         'w_neighbors': {'Cly': 1, 'NTH': 1, 'NWG': 1, 'Yor': 1}},
 'Fin': {'center': {'x': 375, 'y': 160},
         'l_neighbors': {'Nwy': 1, 'Stp': 1, 'Swe': 1},
         'name': 'Finland',
         'path': 'M362,107 L368,108 L372,120 L366,121 L359,136 L345,151 '
                 'L347,160 L350,165 L348,178 L349,184 L357,186 L365,191 '
                 'L384,185 L402,177 L412,161 L410,152 L414,147 L410,130 '
                 'L402,118 L401,110 L392,92 L393,73 L387,68 L388,61 L386,58 '
                 'L388,54 L379,48 L370,49 L369,61 L355,62 L346,54 L342,61 '
                 'L356,71Z',
         'type': 'l',
         'unit_center': {'x': 385, 'y': 143},
         'w_neighbors': {'BOT': 1, 'Stpsc': 1, 'Swe': 1}},
 'Gal': {'center': {'x': 355, 'y': 343},
         'l_neighbors': {'Boh': 1,
                         'Bud': 1,
                         'Gal': 1,
                         'Rum': 1,
                         'Sil': 1,
                         'Ukr': 1,
                         'Vie': 1,
                         'War': 1},
         'name': 'Galicia',
         'path': 'M333,330 L341,330 L344,332 L353,327 L356,323 L361,324 '
                 'L367,329 L374,327 L379,324 L383,327 L385,332 L399,338 '
                 'L404,354 L403,360 L404,371 L394,376 L384,365 L378,363 '
                 'L377,360 L368,353 L360,351 L350,347 L337,350 L329,346 '
                 'L322,347 L321,339 L322,347 L321,339 L325,340 L329,338Z',
         'type': 'l',
         'unit_center': {'x': 377, 'y': 343},
         'w_neighbors': {}},
 'Gas': {'center': {'x': 130, 'y': 400},
         'l_neighbors': {'Bre': 1, 'Bur': 1, 'Mar': 1, 'Par': 1, 'Spa': 1},
         'name': 'Gascony',
         'path': 'M128,363 L121,382 L122,384 L112,399 L113,407 L123,412 '
                 'L134,417 L135,414 L142,417 L149,403 L157,397 L168,395 '
                 'L163,387 L165,383 L158,380 L156,374 L149,372 L146,365Z',
         'type': 'l',
         'unit_center': {'x': 137, 'y': 388},
         'w_neighbors': {'Bre': 1, 'MAO': 1, 'Spanc': 1}},
 'Gre': {'center': {'x': 352, 'y': 490},
         'l_neighbors': {'Alb': 1, 'Bul': 1, 'Ser': 1},
         'name': 'Greece',
         'path': 'M339,487 L346,498 L350,498 L347,500 L352,508 L367,507 '
                 'L371,511 L355,510 L350,514 L357,521 L359,533 L360,528 '
                 'L367,536 L368,531 L376,537 L371,520 L378,521 L377,513 '
                 'L386,516 L385,509 L370,494 L371,491 L378,494 L368,483 '
                 'L371,477 L379,484 L382,483 L381,477 L386,478 L380,472 '
                 'L392,472 L388,460 L376,464 L369,464 L361,467 L356,471 '
                 'L350,471 L350,477Z',
         'sc': {'x': 378, 'y': 507},
         'type': 'l',
         'unit_center': {'x': 366, 'y': 515},
         'w_neighbors': {'AEG': 1, 'Alb': 1, 'Bulsc': 1, 'ION': 1}},
 'HEL': {'center': {'x': 220, 'y': 265},
         'l_neighbors': {'Den': 1, 'Hol': 1, 'Kie': 1},
         'name': 'Helgoland Bight',
         'path': 'M245,237 L243,247 L244,254 L243,257 L245,263 L244,270 '
                 'L244,273 L235,277 L234,274 L230,273 L226,275 L211,274 '
                 'L211,237Z',
         'type': 'w',
         'unit_center': {'x': 226, 'y': 252},
         'w_neighbors': {'NTH': 1}},
 'Hol': {'center': {'x': 210, 'y': 290},
         'l_neighbors': {'Bel': 1, 'Kie': 1, 'Ruh': 1},
         'name': 'Holland',
         'path': 'M226,275 L227,280 L225,292 L220,298 L215,297 L213,302 '
                 'L210,313 L208,315 L205,311 L206,306 L194,303 L191,299 '
                 'L198,289 L205,276 L205,279 L207,279 L211,274Z',
         'sc': {'x': 205, 'y': 284},
         'type': 'l',
         'unit_center': {'x': 205, 'y': 297},
         'w_neighbors': {'Bel': 1, 'HEL': 1, 'Kie': 1, 'NTH': 1}},
 'ION': {'center': {'x': 315, 'y': 520},
         'l_neighbors': {'Alb': 1, 'Apu': 1, 'Gre': 1, 'Nap': 1, 'Tun': 1},
         'name': 'Ionian Sea',
         'path': 'M289,511 L290,514 L295,515 L308,500 L311,491 L304,484 '
                 'L310,480 L318,485 L322,485 L322,480 L335,480 L339,487 '
                 'L346,498 L350,498 L347,500 L352,508 L367,507 L371,511 '
                 'L355,510 L350,514 L357,521 L359,533 L360,528 L367,536 '
                 'L368,531 L376,537 L383,544 L380,547 L383,550 L400,554 '
                 'L400,559 L232,559 L234,551 L232,544 L225,535 L231,531 '
                 'L236,524 L247,513 L258,519 L273,531 L281,532 L282,521 '
                 'L285,513 L285,511Z',
         'type': 'w',
         'unit_center': {'x': 324, 'y': 540},
         'w_neighbors': {'ADR': 1, 'AEG': 1, 'EAS': 1, 'TYS': 1}},
 'IRI': {'center': {'x': 95, 'y': 270},
         'l_neighbors': {'Lvp': 1, 'Wal': 1},
         'name': 'Irish Sea',
         'path': 'M100,291 L112,287 L122,281 L130,282 L127,276 L119,272 '
                 'L116,272 L115,265 L128,262 L126,256 L121,257 L132,250 '
                 'L135,250 L139,240 L136,229 L130,227 L120,227 L110,232 '
                 'L109,246 L98,259 L87,257 L70,261 L58,273 L88,303Z',
         'type': 'w',
         'unit_center': {'x': 90, 'y': 276},
         'w_neighbors': {'ENG': 1, 'MAO': 1, 'NAO': 1}},
 'Kie': {'center': {'x': 237, 'y': 285},
         'l_neighbors': {'Ber': 1, 'Den': 1, 'Hol': 1, 'Mun': 1, 'Ruh': 1},
         'name': 'Kiel',
         'path': 'M244,254 L243,257 L245,263 L244,270 L244,273 L235,277 '
                 'L234,274 L230,273 L226,275 L227,280 L225,292 L220,298 '
                 'L215,297 L213,302 L232,308 L241,316 L243,322 L263,310 '
                 'L261,296 L264,293 L262,287 L266,283 L266,275 L261,274 '
                 'L260,269 L256,266 L256,263 L254,255Z',
         'sc': {'x': 254, 'y': 278},
         'type': 'l',
         'unit_center': {'x': 243, 'y': 295},
         'w_neighbors': {'BAL': 1, 'Ber': 1, 'Den': 1, 'HEL': 1, 'Hol': 1}},
 'LYO': {'center': {'x': 170, 'y': 457},
         'l_neighbors': {'Mar': 1, 'Pie': 1, 'Spasc': 1, 'Tus': 1},
         'name': 'Gulf of Lyon',
         'path': 'M115,469 L110,461 L124,444 L131,439 L146,438 L157,432 '
                 'L158,425 L158,418 L169,412 L176,417 L188,422 L198,421 '
                 'L211,416 L222,410 L233,415 L238,431 L224,431 L221,434 '
                 'L211,436 L213,451 L218,454 L218,458 L214,461 L206,462 '
                 'L205,466 L154,466 L148,463 L142,469Z',
         'type': 'w',
         'unit_center': {'x': 180, 'y': 444},
         'w_neighbors': {'TYS': 1, 'WES': 1}},
 'Lon': {'center': {'x': 160, 'y': 280},
         'l_neighbors': {'Wal': 1, 'Yor': 1},
         'name': 'London',
         'path': 'M166,269 L168,270 L171,268 L177,270 L178,274 L176,283 '
                 'L165,293 L172,294 L168,296 L160,298 L147,295 L145,281 '
                 'L150,277 L153,271Z',
         'sc': {'x': 156, 'y': 289},
         'type': 'l',
         'unit_center': {'x': 162, 'y': 281},
         'w_neighbors': {'ENG': 1, 'NTH': 1, 'Wal': 1, 'Yor': 1}},
 'Lvn': {'center': {'x': 380, 'y': 260},
         'l_neighbors': {'Mos': 1, 'Pru': 1, 'Stp': 1, 'War': 1},
         'name': 'Livonia',
         'path': 'M369,202 L365,204 L368,210 L372,213 L373,221 L377,227 '
                 'L373,229 L366,228 L359,220 L349,229 L347,243 L354,251 '
                 'L356,261 L362,260 L367,265 L365,281 L372,283 L379,290 '
                 'L389,285 L392,278 L404,275 L405,239 L409,228 L405,217 '
                 'L394,205 L382,206 L372,205Z',
         'type': 'l',
         'unit_center': {'x': 382, 'y': 245},
         'w_neighbors': {'BAL': 1, 'BOT': 1, 'Pru': 1, 'Stpsc': 1}},
 'Lvp': {'center': {'x': 134, 'y': 226},
         'l_neighbors': {'Cly': 1, 'Edi': 1, 'Wal': 1, 'Yor': 1},
         'name': 'Liverpool',
         'path': 'M128,262 L126,256 L121,257 L132,250 L135,250 L139,240 '
                 'L136,229 L130,227 L130,223 L138,217 L138,214 L144,213 '
                 'L145,217 L155,228 L155,239 L151,248 L150,264 L143,262Z',
         'sc': {'x': 142, 'y': 253},
         'type': 'l',
         'unit_center': {'x': 142, 'y': 241},
         'w_neighbors': {'Cly': 1, 'IRI': 1, 'NAO': 1, 'Wal': 1}},
 'MAO': {'center': {'x': 50, 'y': 355},
         'l_neighbors': {'Bre': 1,
                         'Gas': 1,
                         'Naf': 1,
                         'Por': 1,
                         'Spanc': 1,
                         'Spasc': 1},
         'name': 'Mid-Atlantic Ocean',
         'path': 'M102,317 L100,322 L103,328 L109,329 L123,344 L122,350 '
                 'L123,357 L128,363 L121,382 L122,384 L112,399 L101,396 '
                 'L96,397 L72,384 L59,381 L54,375 L48,374 L46,378 L39,375 '
                 'L33,381 L35,384 L32,396 L30,406 L17,427 L14,427 L10,433 '
                 'L13,440 L15,441 L12,450 L13,454 L8,462 L19,469 L27,468 '
                 'L33,475 L34,484 L37,490 L37,495 L33,496 L17,518 L0,520 '
                 'L0,273 L58,273Z',
         'type': 'w',
         'unit_center': {'x': 23, 'y': 355},
         'w_neighbors': {'ENG': 1, 'IRI': 1, 'NAO': 1, 'WES': 1}},
 'Mar': {'center': {'x': 173, 'y': 412},
         'l_neighbors': {'Bur': 1, 'Gas': 1, 'Pie': 1, 'Spa': 1},
         'name': 'Marseilles',
         'path': 'M142,417 L149,403 L157,397 L168,395 L173,396 L178,390 '
                 'L178,381 L194,382 L197,385 L203,379 L207,386 L204,390 '
                 'L207,396 L201,399 L204,402 L203,410 L211,416 L198,421 '
                 'L188,422 L176,417 L169,412 L158,418 L158,425 L154,427Z',
         'sc': {'x': 190, 'y': 412},
         'type': 'l',
         'unit_center': {'x': 184, 'y': 402},
         'w_neighbors': {'LYO': 1, 'Pie': 1, 'Spasc': 1}},
 'Mos': {'center': {'x': 460, 'y': 265},
         'l_neighbors': {'Lvn': 1, 'Sev': 1, 'Stp': 1, 'Ukr': 1, 'War': 1},
         'name': 'Moscow',
         'path': 'M609,117 L598,132 L573,143 L564,159 L534,164 L515,169 '
                 'L489,184 L476,183 L458,194 L456,207 L457,210 L451,213 '
                 'L447,209 L439,211 L428,225 L421,229 L409,228 L405,239 '
                 'L404,275 L392,278 L389,285 L379,290 L386,309 L390,306 '
                 'L456,292 L468,295 L477,289 L494,295 L505,280 L516,286 '
                 'L526,287 L533,283 L549,284 L554,304 L564,305 L569,321 '
                 'L597,330 L609,330Z',
         'sc': {'x': 481, 'y': 234},
         'type': 'l',
         'unit_center': {'x': 505, 'y': 226},
         'w_neighbors': {}},
 'Mun': {'center': {'x': 235, 'y': 360},
         'l_neighbors': {'Ber': 1,
                         'Boh': 1,
                         'Bur': 1,
                         'Kie': 1,
                         'Ruh': 1,
                         'Sil': 1,
                         'Tyr': 1},
         'name': 'Munich',
         'path': 'M234,366 L243,370 L246,369 L250,371 L267,368 L271,370 '
                 'L269,362 L275,362 L281,356 L276,346 L268,343 L264,329 '
                 'L266,325 L278,326 L288,321 L284,314 L288,305 L263,310 '
                 'L243,322 L237,322 L219,344 L211,346 L213,352 L209,363 '
                 'L222,365 L225,362 L232,363Z',
         'sc': {'x': 258, 'y': 359},
         'type': 'l',
         'unit_center': {'x': 243, 'y': 347},
         'w_neighbors': {}},
 'NAO': {'center': {'x': 65, 'y': 180},
         'l_neighbors': {'Cly': 1, 'Lvp': 1},
         'name': 'North Atlantic Ocean',
         'path': 'M70,261 L64,250 L67,242 L71,245 L81,234 L74,228 L80,225 '
                 'L78,218 L82,217 L89,220 L94,220 L95,218 L94,216 L97,216 '
                 'L101,212 L110,212 L119,217 L120,227 L130,227 L130,223 '
                 'L138,217 L138,214 L130,208 L129,197 L139,189 L140,182 '
                 'L148,177 L148,0 L0,0 L0,273 L58,273Z',
         'type': 'w',
         'unit_center': {'x': 65, 'y': 200},
         'w_neighbors': {'IRI': 1, 'MAO': 1, 'NWG': 1}},
 'NTH': {'center': {'x': 190, 'y': 230},
         'l_neighbors': {'Bel': 1,
                         'Den': 1,
                         'Edi': 1,
                         'Hol': 1,
                         'Lon': 1,
                         'Nwy': 1,
                         'Yor': 1},
         'name': 'North Sea',
         'path': 'M245,237 L248,224 L241,224 L241,209 L231,201 L229,192 '
                 'L233,186 L231,180 L233,167 L237,160 L236,154 L198,154 '
                 'L171,181 L171,197 L170,202 L165,210 L158,214 L151,215 '
                 'L157,216 L161,218 L163,226 L163,239 L168,246 L170,252 '
                 'L169,265 L166,269 L168,270 L171,268 L177,270 L178,274 '
                 'L176,283 L165,293 L172,294 L168,296 L173,301 L191,299 '
                 'L198,289 L205,276 L205,279 L207,279 L211,274 L211,237Z',
         'type': 'w',
         'unit_center': {'x': 204, 'y': 215},
         'w_neighbors': {'ENG': 1, 'HEL': 1, 'NWG': 1, 'SKA': 1}},
 'NWG': {'center': {'x': 220, 'y': 70},
         'l_neighbors': {'Cly': 1, 'Edi': 1, 'Nwy': 1},
         'name': 'Norwegian Sea',
         'path': 'M362,33 L357,39 L343,44 L324,54 L320,64 L310,75 L309,84 '
                 'L303,86 L292,111 L277,132 L269,134 L264,142 L258,141 '
                 'L236,154 L198,154 L171,181 L171,197 L158,193 L152,194 '
                 'L154,188 L161,185 L162,181 L148,177 L148,0 L362,0Z',
         'type': 'w',
         'unit_center': {'x': 220, 'y': 90},
         'w_neighbors': {'BAR': 1, 'NAO': 1, 'NTH': 1}},
 'Naf': {'center': {'x': 130, 'y': 536},
         'l_neighbors': {'Tun': 1},
         'name': 'North Africa',
         'path': 'M203,520 L179,515 L169,518 L150,511 L117,509 L106,511 '
                 'L99,515 L89,512 L84,518 L79,520 L68,516 L68,511 L64,514 '
                 'L46,509 L42,502 L41,494 L37,495 L33,496 L17,518 L0,520 '
                 'L0,559 L195,559 L197,527Z',
         'type': 'l',
         'unit_center': {'x': 100, 'y': 536},
         'w_neighbors': {'MAO': 1, 'Tun': 1, 'WES': 1}},
 'Nap': {'center': {'x': 294, 'y': 492},
         'l_neighbors': {'Apu': 1, 'Rom': 1},
         'name': 'Naples',
         'path': 'M271,464 L276,474 L290,487 L294,502 L289,511 L290,514 '
                 'L295,515 L308,500 L311,491 L304,484 L293,481 L279,458Z',
         'sc': {'x': 278, 'y': 469},
         'type': 'l',
         'unit_center': {'x': 299, 'y': 505},
         'w_neighbors': {'Apu': 1, 'ION': 1, 'Rom': 1, 'TYS': 1}},
 'Nwy': {'center': {'x': 250, 'y': 175},
         'l_neighbors': {'Fin': 1, 'Stp': 1, 'Swe': 1},
         'name': 'Norway',
         'path': 'M397,48 L391,47 L395,41 L394,38 L384,33 L382,40 L380,33 '
                 'L377,31 L374,38 L371,33 L366,42 L366,33 L362,33 L357,39 '
                 'L343,44 L324,54 L320,64 L310,75 L309,84 L303,86 L292,111 '
                 'L277,132 L269,134 L264,142 L258,141 L236,154 L237,160 '
                 'L233,167 L231,180 L233,186 L229,192 L231,201 L241,209 '
                 'L246,210 L266,201 L270,193 L275,203 L279,204 L287,177 '
                 'L285,170 L290,164 L292,133 L301,132 L300,126 L309,115 '
                 'L308,104 L311,101 L324,71 L332,74 L330,64 L341,65 L342,61 '
                 'L346,54 L355,62 L369,61 L370,49 L379,48 L388,54 L386,58 '
                 'L388,61Z',
         'sc': {'x': 270, 'y': 187},
         'type': 'l',
         'unit_center': {'x': 264, 'y': 160},
         'w_neighbors': {'BAR': 1,
                         'NTH': 1,
                         'NWG': 1,
                         'SKA': 1,
                         'Stpnc': 1,
                         'Swe': 1}},
 'Par': {'center': {'x': 155, 'y': 358},
         'l_neighbors': {'Bre': 1, 'Bur': 1, 'Gas': 1, 'Pic': 1},
         'name': 'Paris',
         'path': 'M146,365 L149,372 L156,374 L165,365 L185,344 L188,332 '
                 'L172,328 L165,331 L159,331 L148,329 L146,337Z',
         'sc': {'x': 177, 'y': 338},
         'type': 'l',
         'unit_center': {'x': 162, 'y': 346},
         'w_neighbors': {}},
 'Pic': {'center': {'x': 168, 'y': 326},
         'l_neighbors': {'Bel': 1, 'Bre': 1, 'Bur': 1, 'Par': 1},
         'name': 'Picardy',
         'path': 'M169,311 L153,315 L155,320 L150,319 L148,329 L159,331 '
                 'L165,331 L172,328 L188,332 L192,323 L184,315Z',
         'type': 'l',
         'unit_center': {'x': 168, 'y': 319},
         'w_neighbors': {'Bel': 1, 'Bre': 1, 'ENG': 1}},
 'Pie': {'center': {'x': 215, 'y': 408},
         'l_neighbors': {'Mar': 1, 'Tus': 1, 'Tyr': 1, 'Ven': 1},
         'name': 'Piedmont',
         'path': 'M207,386 L204,390 L207,396 L201,399 L204,402 L203,410 '
                 'L211,416 L222,410 L233,415 L236,411 L233,404 L246,392 '
                 'L243,388 L229,385 L227,390 L221,385 L213,387Z',
         'type': 'l',
         'unit_center': {'x': 220, 'y': 399},
         'w_neighbors': {'LYO': 1, 'Mar': 1, 'Tus': 1}},
 'Por': {'center': {'x': 22, 'y': 440},
         'l_neighbors': {'Spa': 1},
         'name': 'Portugal',
         'path': 'M32,396 L30,406 L17,427 L14,427 L10,433 L13,440 L15,441 '
                 'L12,450 L13,454 L8,462 L19,469 L27,468 L36,457 L34,447 '
                 'L40,441 L37,431 L42,432 L52,412 L61,411 L62,407 L55,400 '
                 'L42,399 L43,395Z',
         'sc': {'x': 15, 'y': 434},
         'type': 'l',
         'unit_center': {'x': 34, 'y': 417},
         'w_neighbors': {'MAO': 1, 'Spanc': 1, 'Spasc': 1}},
 'Pru': {'center': {'x': 335, 'y': 283},
         'l_neighbors': {'Ber': 1, 'Lvn': 1, 'Sil': 1, 'War': 1},
         'name': 'Prussia',
         'path': 'M347,243 L347,248 L348,254 L344,262 L337,264 L334,273 '
                 'L328,274 L326,265 L314,266 L307,273 L294,275 L292,290 '
                 'L297,296 L296,300 L320,303 L324,299 L326,292 L341,287 '
                 'L345,289 L359,286 L365,281 L367,265 L362,260 L356,261 '
                 'L354,251Z',
         'type': 'l',
         'unit_center': {'x': 315, 'y': 283},
         'w_neighbors': {'BAL': 1, 'Ber': 1, 'Lvn': 1}},
 'Rom': {'center': {'x': 262, 'y': 457},
         'l_neighbors': {'Apu': 1, 'Nap': 1, 'Tus': 1, 'Ven': 1},
         'name': 'Rome',
         'path': 'M247,442 L248,447 L256,458 L271,464 L279,458 L280,455 '
                 'L279,451 L274,447 L263,434 L250,438Z',
         'sc': {'x': 268, 'y': 448},
         'type': 'l',
         'unit_center': {'x': 255, 'y': 445},
         'w_neighbors': {'Nap': 1, 'TYS': 1, 'Tus': 1}},
 'Ruh': {'center': {'x': 215, 'y': 330},
         'l_neighbors': {'Bel': 1, 'Bur': 1, 'Hol': 1, 'Kie': 1, 'Mun': 1},
         'name': 'Ruhr',
         'path': 'M213,302 L210,313 L208,315 L210,326 L205,331 L204,338 '
                 'L211,346 L219,344 L237,322 L243,322 L241,316 L232,308Z',
         'type': 'l',
         'unit_center': {'x': 223, 'y': 320},
         'w_neighbors': {}},
 'Rum': {'center': {'x': 410, 'y': 415},
         'l_neighbors': {'Bud': 1,
                         'Bul': 1,
                         'Gal': 1,
                         'Ser': 1,
                         'Sev': 1,
                         'Ukr': 1},
         'name': 'Rumania',
         'path': 'M403,360 L404,371 L394,376 L395,382 L401,385 L406,396 '
                 'L401,402 L387,402 L367,406 L365,412 L367,421 L370,425 '
                 'L375,423 L382,427 L390,425 L398,427 L404,422 L410,420 '
                 'L422,420 L430,423 L432,409 L439,404 L438,397 L427,399 '
                 'L422,382 L423,376 L414,372 L411,361Z',
         'sc': {'x': 402, 'y': 413},
         'type': 'l',
         'unit_center': {'x': 415, 'y': 405},
         'w_neighbors': {'BLA': 1, 'Bulec': 1, 'Sev': 1}},
 'SKA': {'center': {'x': 255, 'y': 220},
         'l_neighbors': {'Den': 1, 'Nwy': 1, 'Swe': 1},
         'name': 'Skagerrak',
         'path': 'M241,209 L246,210 L266,201 L270,193 L275,203 L277,218 '
                 'L276,224 L282,236 L279,240 L279,243 L275,242 L269,243 '
                 'L266,240 L267,234 L266,221 L263,223 L248,224 L241,224Z',
         'type': 'w',
         'unit_center': {'x': 260, 'y': 212},
         'w_neighbors': {'BAL': 1, 'NTH': 1}},
 'Ser': {'center': {'x': 350, 'y': 450},
         'l_neighbors': {'Alb': 1,
                         'Bud': 1,
                         'Bul': 1,
                         'Gre': 1,
                         'Rum': 1,
                         'Tri': 1},
         'name': 'Serbia',
         'path': 'M365,412 L360,413 L342,410 L338,412 L335,410 L332,410 '
                 'L330,416 L331,424 L327,429 L330,437 L337,446 L346,452 '
                 'L346,466 L350,471 L356,471 L361,467 L369,464 L365,461 '
                 'L371,456 L366,439 L371,438 L368,433 L365,425 L367,421Z',
         'sc': {'x': 343, 'y': 419},
         'type': 'l',
         'unit_center': {'x': 351, 'y': 438},
         'w_neighbors': {}},
 'Sev': {'center': {'x': 540, 'y': 350},
         'l_neighbors': {'Arm': 1, 'Mos': 1, 'Rum': 1, 'Ukr': 1},
         'name': 'Sevastopol',
         'path': 'M438,397 L446,378 L459,375 L461,377 L459,379 L465,383 '
                 'L476,381 L478,383 L472,385 L468,392 L477,396 L477,401 '
                 'L486,404 L488,397 L494,396 L497,392 L507,389 L506,384 '
                 'L494,387 L485,378 L503,364 L526,351 L527,354 L514,365 '
                 'L517,371 L520,371 L515,384 L511,383 L510,386 L517,393 '
                 'L528,394 L554,406 L567,408 L573,417 L570,427 L589,442 '
                 'L594,439 L603,441 L609,440 L609,330 L597,330 L569,321 '
                 'L564,305 L554,304 L549,284 L533,283 L526,287 L516,286 '
                 'L505,280 L494,295 L477,289 L468,295 L470,303 L466,307 '
                 'L460,345 L445,350 L434,360 L432,372 L423,376 L422,382 '
                 'L427,399Z',
         'sc': {'x': 479, 'y': 393},
         'type': 'l',
         'unit_center': {'x': 515, 'y': 330},
         'w_neighbors': {'Arm': 1, 'BLA': 1, 'Rum': 1}},
 'Sil': {'center': {'x': 304, 'y': 325},
         'l_neighbors': {'Ber': 1,
                         'Boh': 1,
                         'Gal': 1,
                         'Mun': 1,
                         'Pru': 1,
                         'War': 1},
         'name': 'Silesia',
         'path': 'M288,321 L297,322 L311,334 L314,332 L321,339 L325,340 '
                 'L329,338 L333,330 L326,327 L323,322 L320,303 L296,300 '
                 'L288,305 L284,314Z',
         'type': 'l',
         'unit_center': {'x': 304, 'y': 314},
         'w_neighbors': {}},
 'Smy': {'center': {'x': 460, 'y': 510},
         'l_neighbors': {'Ank': 1, 'Arm': 1, 'Con': 1, 'Syr': 1},
         'name': 'Smyrna',
         'path': 'M417,489 L420,495 L417,498 L417,507 L423,510 L427,524 '
                 'L435,523 L435,530 L441,526 L447,528 L453,534 L464,531 '
                 'L466,521 L475,520 L485,528 L491,530 L505,526 L511,514 '
                 'L520,517 L527,508 L530,509 L536,494 L545,486 L555,484 '
                 'L563,479 L562,471 L556,467 L555,460 L546,462 L531,460 '
                 'L508,480 L501,482 L490,480 L473,491 L466,491 L452,495 '
                 'L432,493 L423,487Z',
         'sc': {'x': 424, 'y': 502},
         'type': 'l',
         'unit_center': {'x': 490, 'y': 505},
         'w_neighbors': {'AEG': 1, 'Con': 1, 'EAS': 1, 'Syr': 1}},
 'Spa': {'center': {'x': 85, 'y': 450},
         'coasts': {'nc': {'path': 'M134,417 L123,412 L113,407 L112,399 '
                                   'L101,396 L96,397 L72,384 L59,381 L54,375 '
                                   'L48,374 L46,378 L39,375 L33,381 L35,384 '
                                   'L32,396 L43,395 L42,399 L55,400 L62,407 '
                                   'L61,411 L52,412 L42,432 L37,431 L40,441',
                           'x': 80,
                           'y': 404},
                    'sc': {'path': 'M134,417 L40,441 L34,447 L36,457 L27,468 '
                                   'L33,475 L34,484 L37,490 L47,488 L52,489 '
                                   'L60,486 L78,491 L83,494 L86,485 L90,483 '
                                   'L98,484 L107,474 L113,473 L115,469 '
                                   'L110,461 L124,444 L131,439 L146,438 '
                                   'L157,432 L158,425 L154,427 L142,417 '
                                   'L135,414Z',
                           'x': 52,
                           'y': 475}},
         'l_neighbors': {'Gas': 1, 'Mar': 1, 'Por': 1, 'Spa': 1},
         'name': 'Spain',
         'path': 'M134,417 L123,412 L113,407 L112,399 L101,396 L96,397 L72,384 '
                 'L59,381 L54,375 L48,374 L46,378 L39,375 L33,381 L35,384 '
                 'L32,396 L43,395 L42,399 L55,400 L62,407 L61,411 L52,412 '
                 'L42,432 L37,431 L40,441 L40,441 L34,447 L36,457 L27,468 '
                 'L33,475 L34,484 L37,490 L47,488 L52,489 L60,486 L78,491 '
                 'L83,494 L86,485 L90,483 L98,484 L107,474 L113,473 L115,469 '
                 'L110,461 L124,444 L131,439 L146,438 L157,432 L158,425 '
                 'L154,427 L142,417 L135,414Z',
         'sc': {'x': 80, 'y': 432},
         'type': 'l',
         'unit_center': {'x': 64, 'y': 439},
         'w_neighbors': {'nc': {'Gas': 1, 'MAO': 1, 'Por': 1},
                         'sc': {'LYO': 1,
                                'MAO': 1,
                                'Mar': 1,
                                'Por': 1,
                                'WES': 1}}},
 'Stp': {'center': {'x': 460, 'y': 149},
         'coasts': {'nc': {'path': 'M534,164 L564,159 L573,143 L598,132 '
                                   'L609,117 L609,0 L540,0 L535,9 L530,6 '
                                   'L517,19 L516,33 L513,38 L513,23 L507,20 '
                                   'L505,26 L499,33 L492,48 L495,58 L488,60 '
                                   'L479,57 L477,55 L481,50 L473,43 L466,45 '
                                   'L472,62 L478,66 L478,74 L472,72 L468,74 '
                                   'L457,91 L469,100 L467,106 L462,109 '
                                   'L444,101 L442,110 L447,115 L454,119 '
                                   'L452,122 L434,118 L426,103 L426,94 L414,88 '
                                   'L412,83 L445,84 L457,79 L459,66 L453,61 '
                                   'L417,47 L405,49 L401,45 L397,48 L388,61 '
                                   'L387,68 L393,73 L392,92 L401,110 L402,118 '
                                   'L410,130 L414,147 L476,183 L489,184 '
                                   'L515,169Z',
                           'x': 472,
                           'y': 122},
                    'sc': {'path': 'M414,147 L410,152 L412,161 L402,177 '
                                   'L403,183 L411,184 L414,187 L408,187 '
                                   'L400,192 L399,197 L387,196 L371,198 '
                                   'L369,202 L372,205 L382,206 L394,205 '
                                   'L405,217 L409,228 L421,229 L428,225 '
                                   'L439,211 L447,209 L451,213 L457,210 '
                                   'L456,207 L458,194 L476,183Z',
                           'x': 418,
                           'y': 205}},
         'l_neighbors': {'Fin': 1, 'Lvn': 1, 'Mos': 1, 'Nwy': 1},
         'name': 'St Petersburg',
         'path': 'M534,164 L564,159 L573,143 L598,132 L609,117 L609,0 L540,0 '
                 'L535,9 L530,6 L517,19 L516,33 L513,38 L513,23 L507,20 '
                 'L505,26 L499,33 L492,48 L495,58 L488,60 L479,57 L477,55 '
                 'L481,50 L473,43 L466,45 L472,62 L478,66 L478,74 L472,72 '
                 'L468,74 L457,91 L469,100 L467,106 L462,109 L444,101 L442,110 '
                 'L447,115 L454,119 L452,122 L434,118 L426,103 L426,94 L414,88 '
                 'L412,83 L445,84 L457,79 L459,66 L453,61 L417,47 L405,49 '
                 'L401,45 L397,48 L388,61 L387,68 L393,73 L392,92 L401,110 '
                 'L402,118 L410,130 L414,147 L410,152 L412,161 L402,177 '
                 'L403,183 L411,184 L414,187 L408,187 L400,192 L399,197 '
                 'L387,196 L371,198 L369,202 L372,205 L382,206 L394,205 '
                 'L405,217 L409,228 L421,229 L428,225 L439,211 L447,209 '
                 'L451,213 L457,210 L456,207 L458,194 L476,183 L489,184 '
                 'L515,169Z',
         'sc': {'x': 418, 'y': 187},
         'type': 'l',
         'unit_center': {'x': 500, 'y': 140},
         'w_neighbors': {'nc': {'BAR': 1, 'Nwy': 1},
                         'sc': {'BOT': 1, 'Fin': 1, 'Lvn': 1}}},
 'Swe': {'center': {'x': 300, 'y': 170},
         'l_neighbors': {'Den': 1, 'Fin': 1, 'Nwy': 1},
         'name': 'Sweden',
         'path': 'M275,203 L277,218 L276,224 L282,236 L279,240 L279,243 '
                 'L282,253 L289,254 L294,245 L305,244 L312,229 L311,220 '
                 'L314,209 L322,206 L328,203 L331,193 L326,183 L320,182 '
                 'L321,161 L330,146 L343,138 L351,128 L347,121 L349,112 '
                 'L355,104 L362,107 L356,71 L342,61 L341,65 L330,64 L332,74 '
                 'L324,71 L311,101 L308,104 L309,115 L300,126 L301,132 '
                 'L292,133 L290,164 L285,170 L287,177 L279,204Z',
         'sc': {'x': 323, 'y': 196},
         'type': 'l',
         'unit_center': {'x': 315, 'y': 140},
         'w_neighbors': {'BAL': 1,
                         'BOT': 1,
                         'Den': 1,
                         'Fin': 1,
                         'Nwy': 1,
                         'SKA': 1}},
 'Syr': {'center': {'x': 570, 'y': 535},
         'l_neighbors': {'Arm': 1, 'Smy': 1},
         'name': 'Syria',
         'path': 'M530,509 L536,494 L545,486 L555,484 L563,479 L584,478 '
                 'L609,493 L609,559 L528,559 L532,535 L526,530 L525,518Z',
         'type': 'l',
         'unit_center': {'x': 570, 'y': 520},
         'w_neighbors': {'EAS': 1, 'Smy': 1}},
 'TYS': {'center': {'x': 245, 'y': 495},
         'l_neighbors': {'Nap': 1, 'Rom': 1, 'Tun': 1, 'Tus': 1},
         'name': 'Tyrrhenian Sea',
         'path': 'M238,431 L247,442 L248,447 L256,458 L271,464 L276,474 '
                 'L290,487 L294,502 L289,511 L285,511 L285,508 L276,510 '
                 'L263,510 L257,507 L252,508 L247,513 L236,524 L233,523 '
                 'L224,527 L223,518 L218,516 L218,490 L220,490 L224,468 '
                 'L222,458 L218,458 L218,454 L223,450 L225,444 L225,436 '
                 'L224,431Z',
         'type': 'w',
         'unit_center': {'x': 246, 'y': 483},
         'w_neighbors': {'ION': 1, 'LYO': 1, 'WES': 1}},
 'Tri': {'center': {'x': 305, 'y': 425},
         'l_neighbors': {'Alb': 1,
                         'Bud': 1,
                         'Ser': 1,
                         'Tyr': 1,
                         'Ven': 1,
                         'Vie': 1},
         'name': 'Trieste',
         'path': 'M276,399 L275,403 L278,410 L282,401 L286,402 L289,418 '
                 'L306,436 L331,454 L330,445 L337,446 L330,437 L327,429 '
                 'L331,424 L330,416 L332,410 L323,408 L321,398 L311,394 '
                 'L308,383 L299,385 L294,380 L289,385 L276,386 L279,389Z',
         'sc': {'x': 290, 'y': 396},
         'type': 'l',
         'unit_center': {'x': 305, 'y': 412},
         'w_neighbors': {'ADR': 1, 'Alb': 1, 'Ven': 1}},
 'Tun': {'center': {'x': 210, 'y': 555},
         'l_neighbors': {'Naf': 1},
         'name': 'Tunis',
         'path': 'M232,559 L234,551 L232,544 L225,535 L231,531 L236,524 '
                 'L233,523 L224,527 L223,518 L218,516 L212,517 L208,521 '
                 'L203,520 L197,527 L195,559Z',
         'sc': {'x': 220, 'y': 529},
         'type': 'l',
         'unit_center': {'x': 212, 'y': 542},
         'w_neighbors': {'ION': 1, 'Naf': 1, 'TYS': 1, 'WES': 1}},
 'Tus': {'center': {'x': 240, 'y': 425},
         'l_neighbors': {'Pie': 1, 'Rom': 1, 'Ven': 1},
         'name': 'Tuscany',
         'path': 'M233,415 L238,431 L247,442 L250,438 L263,434 L253,418 '
                 'L246,416 L240,415 L236,411Z',
         'type': 'l',
         'unit_center': {'x': 247, 'y': 430},
         'w_neighbors': {'LYO': 1, 'Pie': 1, 'Rom': 1, 'TYS': 1}},
 'Tyr': {'center': {'x': 255, 'y': 380},
         'l_neighbors': {'Boh': 1,
                         'Mun': 1,
                         'Pie': 1,
                         'Tri': 1,
                         'Ven': 1,
                         'Vie': 1},
         'name': 'Tyrolia',
         'path': 'M234,366 L243,370 L246,369 L250,371 L267,368 L271,370 '
                 'L269,362 L275,362 L281,356 L292,357 L295,362 L294,380 '
                 'L289,385 L276,386 L268,385 L259,388 L255,394 L250,397 '
                 'L246,392 L243,388 L245,384 L241,378 L234,374Z',
         'type': 'l',
         'unit_center': {'x': 277, 'y': 378},
         'w_neighbors': {}},
 'Ukr': {'center': {'x': 420, 'y': 340},
         'l_neighbors': {'Gal': 1, 'Mos': 1, 'Rum': 1, 'Sev': 1, 'War': 1},
         'name': 'Ukraine',
         'path': 'M383,327 L385,332 L399,338 L404,354 L403,360 L411,361 '
                 'L414,372 L423,376 L432,372 L434,360 L445,350 L460,345 '
                 'L466,307 L470,303 L468,295 L456,292 L390,306 L386,309Z',
         'type': 'l',
         'unit_center': {'x': 427, 'y': 327},
         'w_neighbors': {}},
 'Ven': {'center': {'x': 245, 'y': 407},
         'l_neighbors': {'Apu': 1,
                         'Pie': 1,
                         'Rom': 1,
                         'Tri': 1,
                         'Tus': 1,
                         'Tyr': 1},
         'name': 'Venice',
         'path': 'M278,443 L272,424 L260,417 L261,401 L270,398 L276,399 '
                 'L279,389 L276,386 L268,385 L259,388 L255,394 L250,397 '
                 'L246,392 L233,404 L236,411 L240,415 L246,416 L253,418 '
                 'L263,434 L274,447Z',
         'sc': {'x': 263, 'y': 390},
         'type': 'l',
         'unit_center': {'x': 250, 'y': 408},
         'w_neighbors': {'ADR': 1, 'Apu': 1, 'Tri': 1}},
 'Vie': {'center': {'x': 307, 'y': 370},
         'l_neighbors': {'Boh': 1, 'Bud': 1, 'Gal': 1, 'Tri': 1, 'Tyr': 1},
         'name': 'Vienna',
         'path': 'M292,357 L295,349 L303,346 L316,348 L322,347 L329,346 '
                 'L337,350 L335,354 L322,370 L311,375 L308,383 L299,385 '
                 'L294,380 L295,362Z',
         'sc': {'x': 298, 'y': 363},
         'type': 'l',
         'unit_center': {'x': 314, 'y': 360},
         'w_neighbors': {}},
 'WES': {'center': {'x': 160, 'y': 491},
         'l_neighbors': {'Naf': 1, 'Spasc': 1, 'Tun': 1},
         'name': 'Western Mediterranean',
         'path': 'M37,490 L47,488 L52,489 L60,486 L78,491 L83,494 L86,485 '
                 'L90,483 L98,484 L107,474 L113,473 L115,469 L142,469 L150,471 '
                 'L154,466 L205,466 L206,476 L204,485 L208,492 L212,492 '
                 'L217,489 L218,490 L218,516 L212,517 L208,521 L203,520 '
                 'L179,515 L169,518 L150,511 L117,509 L106,511 L99,515 L89,512 '
                 'L84,518 L79,520 L68,516 L68,511 L64,514 L46,509 L42,502 '
                 'L41,494 L37,495Z',
         'type': 'w',
         'unit_center': {'x': 140, 'y': 492},
         'w_neighbors': {'LYO': 1, 'MAO': 1, 'TYS': 1}},
 'Wal': {'center': {'x': 130, 'y': 275},
         'l_neighbors': {'Lon': 1, 'Lvp': 1, 'Yor': 1},
         'name': 'Wales',
         'path': 'M100,291 L112,287 L122,281 L130,282 L127,276 L119,272 '
                 'L116,272 L115,265 L128,262 L143,262 L150,264 L153,271 '
                 'L150,277 L145,281 L147,295 L134,294 L124,291 L120,295 '
                 'L110,292Z',
         'type': 'l',
         'unit_center': {'x': 125, 'y': 285},
         'w_neighbors': {'ENG': 1, 'IRI': 1, 'Lon': 1, 'Lvp': 1}},
 'War': {'center': {'x': 355, 'y': 304},
         'l_neighbors': {'Gal': 1,
                         'Lvn': 1,
                         'Mos': 1,
                         'Pru': 1,
                         'Sil': 1,
                         'Ukr': 1},
         'name': 'Warsaw',
         'path': 'M333,330 L326,327 L323,322 L320,303 L324,299 L326,292 '
                 'L341,287 L345,289 L359,286 L365,281 L372,283 L379,290 '
                 'L386,309 L383,327 L379,324 L374,327 L367,329 L361,324 '
                 'L356,323 L353,327 L344,332 L341,330Z',
         'sc': {'x': 343, 'y': 302},
         'type': 'l',
         'unit_center': {'x': 361, 'y': 315},
         'w_neighbors': {}},
 'Yor': {'center': {'x': 155, 'y': 254},
         'l_neighbors': {'Edi': 1, 'Lon': 1, 'Lvp': 1, 'Wal': 1},
         'name': 'Yorkshire',
         'path': 'M163,226 L163,239 L168,246 L170,252 L169,265 L166,269 '
                 'L153,271 L150,264 L151,248 L155,239 L155,228Z',
         'type': 'l',
         'unit_center': {'x': 161, 'y': 254},
         'w_neighbors': {'Edi': 1, 'Lon': 1, 'NTH': 1}}}

filling_colors = {
        "Turkey": "rgb(187, 187, 0)",
        "Germany":"rgb(0, 0, 0)",
        "England":"rgb(0, 0, 170)",
        "Italy":"rgb(0, 170, 0)",
        "Russia":"rgb(187, 0, 187)",
        "France":"rgb(153, 153, 255)",
        "Austria":"rgb(170, 0, 0)"}



path_to_terr = {}
for t in territories:
    path_to_terr[territories[t]['path'].replace(" ","")] = t
    if "coasts" in territories[t]:
        for k in territories[t]["coasts"]:
            path_to_terr[territories[t]["coasts"][k]['path'].replace(" ", "")] = t


# Map adress : https://www.backstabbr.com/images/map_background.png
# https://www.backstabbr.com/images/legend_fleet.png
# https://www.backstabbr.com/images/legend_army.png

def parseArgs():
    global game_number
    if len(sys.argv) > 1:
        game_number = sys.argv[1]
        print(f"Generating images and gif for game number {game_number}")
    else:
        print(f"Syntax: {sys.argv[0]} game_number")
        print("Game number can be found in the game URL")

parseArgs()

base_url = f"http://www.backstabbr.com/game/{game_number}"
map_url = "https://www.backstabbr.com/images/map_background.png"
map_filename = "map_background.png"
# Download the background map if needed
if not exists(map_filename):
    urllib.request.urlretrieve(map_url, map_filename)

print("Initializing driver")
driver = webdriver.Chrome()

# Temp files created : 
# - output.svg
# - output_fill.svg

def backstabbrGameToPNG(url, outputFileName):
    driver.get(url)

    html = driver.page_source
    image = re.search('<svg.*</svg>', html).group(0).replace("/images/map_background.png", "map_background.png").replace("xlink:href", "href")

    with open("output.svg", "w") as f:
        f.write(image)

    territories_txt = [l for l in html.split('\n') if "territories" in l][0].replace(";","").split(" = ")[1]
    owned_territories = json.loads(territories_txt)

    # ET.register_namespace("","http://www.w3.org/2000/svg")
    mytree = ET.parse('output.svg')
    image_root = mytree.getroot()


    # image_root = ET.fromstring(image)
    for element in image_root:
        if element.tag.endswith("path"):
            # Identify the territory from the 'd'
            d = element.attrib['d']
            if d in path_to_terr:
                ter = path_to_terr[d]
                if ter in owned_territories:
                    if element.attrib['fill'] != "#000000":
                        # print(f"Replacing filling color of {ter} into {filling_colors[owned_territories[ter]]}")
                        # print(f"Replacing fill-opacity of {ter} into 0.3")
                        element.attrib['fill'] = filling_colors[owned_territories[ter]]
                        element.attrib['style'] = '-webkit-tap-highlight-color: rgba(0, 0, 0, 0); fill-opacity: 0.3;'

    mytree.write("output_fill.svg") # , default_namespace="http://www.w3.org/2000/svg")

    drawing = svg2rlg('output_fill.svg')
    renderPM.drawToFile(drawing, outputFileName, fmt='PNG', dpi=150)

def getYearForGame(url):
    driver.get(url)

    html = driver.page_source
    pq = pyquery.PyQuery(html)
    season_year = pq("a#history_current_season.btn.btn-secondary.btn-history").text().split(' ')
    return season_year

class Season(Enum):
    Spring: str = "spring"
    Fall: str = "fall"
    Winter: str = "winter"
    def __eq__(self, other):
        return self.name == other.name
    def __le__(self, other):
        if self == Season.Spring:
            return True
        if self == Season.Fall:
            return other in [Season.Fall, Season.Winter]
        if self == Season.Winter:
            return other == Season.Winter
    def __lt__(self, other):
        return (self <= other) and (self != other)


[cur_season, year] = getYearForGame(base_url)
print(f"Game {game_number} is presently in {cur_season} {year}")
year = int(year)
cur_season = Season(cur_season)

picsGenerated = []
for y in range(1901, year + 1):
    for season in ["spring", "fall", "winter"]:
        if y < year or Season(season) <= cur_season:
            seasonURL = f"{base_url}/{str(y)}/{season}"
            targetName = f'output_{str(y)}_{season}.png'
            print(f"Generating image for {season} {y}")
            backstabbrGameToPNG(seasonURL, targetName)
            picsGenerated.append(targetName)

# Add a 5 s delay to the gif before rebooting
for i in range(5):
    picsGenerated.append(targetName)

# Now generate a gif 
images = []
for filename in picsGenerated:
    images.append(imageio.imread(filename))

imageio.mimsave('all_moves.gif', images, fps=1, loop=1)

driver.quit()
